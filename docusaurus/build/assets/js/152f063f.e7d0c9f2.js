"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2083],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>g});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var m=o.createContext({}),c=function(e){var n=o.useContext(m),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},l=function(e){var n=c(e.components);return o.createElement(m.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,m=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=c(t),p=r,g=u["".concat(m,".").concat(p)]||u[p]||d[p]||i;return t?o.createElement(g,a(a({ref:n},l),{},{components:t})):o.createElement(g,a({ref:n},l))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,a=new Array(i);a[0]=p;var s={};for(var m in n)hasOwnProperty.call(n,m)&&(s[m]=n[m]);s.originalType=e,s[u]="string"==typeof e?e:r,a[1]=s;for(var c=2;c<i;c++)a[c]=t[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},55663:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>m,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var o=t(87462),r=(t(67294),t(3905));const i={sidebar_position:8,tags:["api","domains","network","dns"]},a="Custom domains",s={unversionedId:"tembo-cloud/configuration-and-management/custom-domains",id:"tembo-cloud/configuration-and-management/custom-domains",title:"Custom domains",description:"Configure custom domains that are in your Postgres connection URLs.",source:"@site/docs/tembo-cloud/configuration-and-management/custom-domains.md",sourceDirName:"tembo-cloud/configuration-and-management",slug:"/tembo-cloud/configuration-and-management/custom-domains",permalink:"/docs/tembo-cloud/configuration-and-management/custom-domains",draft:!1,editUrl:"https://github.com/tembo-io/website/blob/main/docs/tembo-cloud/configuration-and-management/custom-domains.md",tags:[{label:"api",permalink:"/docs/tags/api"},{label:"domains",permalink:"/docs/tags/domains"},{label:"network",permalink:"/docs/tags/network"},{label:"dns",permalink:"/docs/tags/dns"}],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8,tags:["api","domains","network","dns"]},sidebar:"tutorialSidebar",previous:{title:"High Availability",permalink:"/docs/tembo-cloud/configuration-and-management/ha_replication"},next:{title:"Troubleshooting",permalink:"/docs/tembo-cloud/configuration-and-management/troubleshooting"}},m={},c=[{value:"Design",id:"design",level:2},{value:"Configuring a custom domain",id:"configuring-a-custom-domain",level:2},{value:"Configure TXT record",id:"configure-txt-record",level:3},{value:"Configure CNAME record",id:"configure-cname-record",level:3},{value:"Configure custom domain in Tembo Cloud",id:"configure-custom-domain-in-tembo-cloud",level:3},{value:"Connect to instance with custom domain",id:"connect-to-instance-with-custom-domain",level:3}],l={toc:c},u="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,o.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"custom-domains"},"Custom domains"),(0,r.kt)("p",null,"Configure custom domains that are in your Postgres connection URLs."),(0,r.kt)("h2",{id:"design"},"Design"),(0,r.kt)("p",null,"Tembo uses Server Name Indication (SNI) for routing encrypted TLS traffic into the correct instance. To allow for custom branding, Tembo provides an option for users to configure additional domain names that will be respected by SNI routing. The user must configure DNS on their domain to route requests to Tembo."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"No two instances can share the same domain name")),(0,r.kt)("h2",{id:"configuring-a-custom-domain"},"Configuring a custom domain"),(0,r.kt)("p",null,"In this example, our instance is called ",(0,r.kt)("inlineCode",{parentName:"p"},"custom-brand-check"),", and we are in the organization ",(0,r.kt)("inlineCode",{parentName:"p"},"steven2"),". First, we confirm that we have access to this instance."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"psql 'postgresql://postgres:*****@org-steven2-inst-custom-brand-check.data-1.use1.tembo.io:5432?sslmode=require'\npsql (15.3 (Homebrew))\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off)\nType \"help\" for help.\n\npostgres=#\n")),(0,r.kt)("p",null,"We want to add an alternate domain name ",(0,r.kt)("inlineCode",{parentName:"p"},"steven.tembo-development.com"),", so that we can connect to our instance with a connection string like this ",(0,r.kt)("inlineCode",{parentName:"p"},"postgresql://postgres:*****@steven.tembo-development.com:5432?sslmode=require"),"."),(0,r.kt)("h3",{id:"configure-txt-record"},"Configure TXT record"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Configure a TXT record on the custom domain name prefixed by ",(0,r.kt)("inlineCode",{parentName:"li"},"_tembo."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"For example, ",(0,r.kt)("inlineCode",{parentName:"li"},"_tembo.steven.tembo-development.com")))),(0,r.kt)("li",{parentName:"ul"},"The value should be the organization ID of the instance",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"For example, ",(0,r.kt)("inlineCode",{parentName:"li"},"org_2T7FJA0DpaNBnELVLU1IS4XzZG0"),".")))),(0,r.kt)("p",null,"Confirming a TXT record is present:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'\u279c  ~ dig -t txt _tembo.steven.tembo-development.com\n\n; <<>> DiG 9.10.6 <<>> -t txt _tembo.steven.tembo-development.com\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 27369\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 512\n;; QUESTION SECTION:\n;_tembo.steven.tembo-development.com. IN        TXT\n\n;; ANSWER SECTION:\n_tembo.steven.tembo-development.com. 300 IN TXT "org_2T7FJA0DpaNBnELVLU1IS4XzZG0"\n\n;; Query time: 51 msec\n;; SERVER: 8.8.8.8#53(8.8.8.8)\n;; WHEN: Mon Sep 11 16:04:42 EDT 2023\n;; MSG SIZE  rcvd: 108\n')),(0,r.kt)("h3",{id:"configure-cname-record"},"Configure CNAME record"),(0,r.kt)("p",null,"Next, we configure a CNAME record so that when clients perform DNS resolution on ",(0,r.kt)("inlineCode",{parentName:"p"},"steven.tembo-development.com"),", they are directed to Tembo Cloud."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add a CNAME record on the domain name, with the value ",(0,r.kt)("inlineCode",{parentName:"li"},"cloud.data-1.use1.tembo.io"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This assumes your database is in ",(0,r.kt)("inlineCode",{parentName:"li"},"data-1.use1"))))),(0,r.kt)("p",null,"Confirming a CNAME record is present:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u279c  ~ dig -t cname steven.tembo-development.com\n\n; <<>> DiG 9.10.6 <<>> -t cname steven.tembo-development.com\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 65291\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 512\n;; QUESTION SECTION:\n;steven.tembo-development.com.  IN      CNAME\n\n;; ANSWER SECTION:\nsteven.tembo-development.com. 300 IN    CNAME   cloud.data-1.use1.tembo.io.\n\n;; Query time: 49 msec\n;; SERVER: 8.8.8.8#53(8.8.8.8)\n;; WHEN: Mon Sep 11 16:08:37 EDT 2023\n;; MSG SIZE  rcvd: 97\n")),(0,r.kt)("p",null,"Also, if you try to connect now, the DNS resolution should direct to Tembo Cloud, but you should get disconnected because there is no SNI configuration yet."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"psql 'postgresql://postgres:****@steven.tembo-development.com:5432?sslmode=require'\n\npsql: error: connection to server at \"steven.tembo-development.com\" (23.23.245.52), port 5432 failed: SSL SYSCALL error: Undefined error: 0\n")),(0,r.kt)("h3",{id:"configure-custom-domain-in-tembo-cloud"},"Configure custom domain in Tembo Cloud"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Configure your instance in Tembo Cloud to use this custom domain name.")),(0,r.kt)("p",null,"For example, using the API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ORG_ID='org_2T7FJA0DpaNBnELVLU1IS4XzZG0'\nINST_ID='inst_1694461015944_UYCow2_0'\nJWT='****'\n\ncurl -X 'PATCH' \\\n  \"https://api.tembo.io/api/v1/orgs/${ORG_ID}/instances/${INST_ID}\" \\\n  -H 'accept: application/json' \\\n  -H \"Authorization: Bearer ${JWT}\" \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"extra_domains_rw\": [\"steven.tembo-development.com\"]\n}'\n")),(0,r.kt)("p",null,"For more information on the API, see our ",(0,r.kt)("a",{parentName:"p",href:"https://tembo.io/docs/tembo-cloud/api"},"API guide"),"."),(0,r.kt)("h3",{id:"connect-to-instance-with-custom-domain"},"Connect to instance with custom domain"),(0,r.kt)("p",null,"Now, connecting to the instance is possible with the custom domain. Just substitute your domain into the connection string."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"psql 'postgresql://postgres:****@steven.tembo-development.com:5432?sslmode=require'\npsql (15.3 (Homebrew))\nSSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off)\nType \"help\" for help.\n\npostgres=#\n")))}d.isMDXComponent=!0}}]);