"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5845],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),c=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(a),g=n,m=p["".concat(s,".").concat(g)]||p[g]||d[g]||o;return a?r.createElement(m,i(i({ref:t},u),{},{components:a})):r.createElement(m,i({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=g;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:n,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}g.displayName="MDXCreateElement"},97542:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var r=a(87462),n=(a(67294),a(3905));const o={slug:"clerk-fdw",title:"Unlocking value from your Clerk User Management platform with Postgres",authors:["jay"],tags:["postgres","extensions"],image:"./clerk-flowchart.png"},i="Unlocking value from your Clerk User Management platform with Postgres",l={permalink:"/blog/clerk-fdw",editUrl:"https://github.com/tembo-io/website/blob/main/blog/2023-10-03-clerk-fdw/index.md",source:"@site/blog/2023-10-03-clerk-fdw/index.md",title:"Unlocking value from your Clerk User Management platform with Postgres",description:"The maxim of building a product is to know your user. However, any company big or small will often have user data spread around in various systems. A data platform team will often deploy various pipelines that can sync data from various sources into a data warehouse. As an alternative, Postgres supports the concept of a Foreign Data Wrapper. Let\u2019s dive into what this is and how it can help us.",date:"2023-10-03T00:00:00.000Z",formattedDate:"October 3, 2023",tags:[{label:"postgres",permalink:"/blog/tags/postgres"},{label:"extensions",permalink:"/blog/tags/extensions"}],readingTime:4.47,hasTruncateMarker:!1,authors:[{name:"Jay Kothari",title:"Software Engineering Intern",url:"https://github.com/Jayko001",email:"noreply@tembo.io",imageURL:"https://github.com/Jayko001.png",key:"jay"}],frontMatter:{slug:"clerk-fdw",title:"Unlocking value from your Clerk User Management platform with Postgres",authors:["jay"],tags:["postgres","extensions"],image:"./clerk-flowchart.png"},prevItem:{title:"Introducing Terraform Provider for Tembo",permalink:"/blog/introducing-terraform-provider-for-tembo"},nextItem:{title:"Version History and Lifecycle Policies for Postgres Tables",permalink:"/blog/table-version-history"}},s={image:a(54371).Z,authorsImageUrls:[void 0]},c=[{value:"What\u2019s a Foreign Data Wrapper?",id:"whats-a-foreign-data-wrapper",level:2},{value:"What\u2019s Clerk?",id:"whats-clerk",level:2},{value:"The Power of Integration",id:"the-power-of-integration",level:2},{value:"Setting up <code>clerk_fdw</code>",id:"setting-up-clerk_fdw",level:2},{value:"Create the foreign data wrapper for clerk",id:"create-the-foreign-data-wrapper-for-clerk",level:3},{value:"Connect to Clerk using your credentials",id:"connect-to-clerk-using-your-credentials",level:3},{value:"Create Foreign Table:",id:"create-foreign-table",level:3},{value:"User table",id:"user-table",level:4},{value:"Organization Table",id:"organization-table",level:4},{value:"Junction Table",id:"junction-table",level:4},{value:"Dive into the Data",id:"dive-into-the-data",level:2},{value:"Conclusion",id:"conclusion",level:2}],u={toc:c},p="wrapper";function d(e){let{components:t,...o}=e;return(0,n.kt)(p,(0,r.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"The maxim of building a product is to know your user. However, any company big or small will often have user data spread around in various systems. A data platform team will often deploy various pipelines that can sync data from various sources into a data warehouse. As an alternative, Postgres supports the concept of a Foreign Data Wrapper. Let\u2019s dive into what this is and how it can help us."),(0,n.kt)("p",null,"In this blog, we'll look at ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/tembo-io/clerk_fdw"},"clerk_fdw"),"\u2014a tool that bridges the gap between ",(0,n.kt)("a",{parentName:"p",href:"https://clerk.com/"},"Clerk"),", a leading user management solution, and your very own Postgres Database. By the end, you'll discover how this integration can empower you to make data-driven decisions, optimize your pricing strategy, and refine your market approach. Let's get started!"),(0,n.kt)("h2",{id:"whats-a-foreign-data-wrapper"},"What\u2019s a Foreign Data Wrapper?"),(0,n.kt)("p",null,"A foreign data wrapper is an extension available in PostgreSQL that allows you to bring \u2018foreign data\u2019 (i.e. data in a different Postgres DB, a different database like DB2, or even a different kind of data source, like an API) and query it the same way you would query a normal Postgres table. They are particularly useful when your data may be segregated into different databases, but are still related in ways that you could gather some useful information from them. In building a foreign data wrapper for Clerk.com, we have used ",(0,n.kt)("a",{parentName:"p",href:"https://supabase.github.io/wrappers/"},"Supabase Wrappers")," that make it easier to build Foreign Data Wrappers and interact with third-party data using SQL."),(0,n.kt)("p",null,"If you should take something away from this blog, is that Postgres\u2019 Foreign Data Wrappers are a great tool to build an analytics platform based on Postgres. See examples of other ",(0,n.kt)("a",{parentName:"p",href:"https://pgt.dev/?cat=connectors"},"FDWs in Trunk")),(0,n.kt)("h2",{id:"whats-clerk"},"What\u2019s Clerk?"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://clerk.com/"},"Clerk")," is a user management tool. With Clerk, users experience a seamless sign-up and sign-in flow, whether they prefer using email, SMS, or even their favorite social media accounts. Its versatility and developer-friendly APIs make it an excellent choice for us at Tembo for both efficiency and a superior user experience."),(0,n.kt)("h2",{id:"the-power-of-integration"},"The Power of Integration"),(0,n.kt)("p",null,"Being able to access data from a User Management Tool like Clerk as part of your data platform is especially useful because it enables you to have a 360-degree view of the user experience on your product, without having to set up any complex data export pipelines from Clerk into other systems."),(0,n.kt)("p",null,"In fact, we built ",(0,n.kt)("inlineCode",{parentName:"p"},"clerk_fdw")," at Tembo to address needs in our internal analytics pipeline . Here are some of the ways we are using it:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Run advanced analytics that combine internal data with user data from Clerk."),(0,n.kt)("li",{parentName:"ul"},"Understand user interaction patterns with our product."),(0,n.kt)("li",{parentName:"ul"},"Identify and engage with top users.")),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"clerk",src:a(54371).Z,title:"clerk_fdw structure",width:"1345",height:"1158"})),(0,n.kt)("h2",{id:"setting-up-clerk_fdw"},"Setting up ",(0,n.kt)("inlineCode",{parentName:"h2"},"clerk_fdw")),(0,n.kt)("p",null,"The first step would be installing the ",(0,n.kt)("inlineCode",{parentName:"p"},"clerk_fdw")," extension. You can ",(0,n.kt)("a",{parentName:"p",href:"https://tembo-io.github.io/trunk/#trunk-install"},"install this extension using trunk"),"."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"trunk install clerk_fdw\n")),(0,n.kt)("p",null,"The next step would be to enable the extension in your postgres instance. You can do so using the following command:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create extension if not exists clerk_fdw;\n")),(0,n.kt)("h3",{id:"create-the-foreign-data-wrapper-for-clerk"},"Create the foreign data wrapper for clerk"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create foreign data wrapper clerk_wrapper\n  handler clerk_fdw_handler\n  validator clerk_fdw_validator;\n")),(0,n.kt)("h3",{id:"connect-to-clerk-using-your-credentials"},"Connect to Clerk using your credentials"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create server my_clerk_server\n  foreign data wrapper clerk_wrapper\n  options (\n    api_key '<clerk secret Key>');\n")),(0,n.kt)("h3",{id:"create-foreign-table"},"Create Foreign Table:"),(0,n.kt)("h4",{id:"user-table"},"User table"),(0,n.kt)("p",null,"This table will store information about the users."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Note: The current limit is 500 users. We are working to increase this limitation in future releases."),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create foreign table clerk_users (\n  user_id text,\n  first_name text,\n  last_name text,\n  email text,\n  gender text,\n  created_at bigint,\n  updated_at bigint,\n  last_sign_in_at bigint,\n  phone_numbers bigint,\n  username text\n  )\n  server my_clerk_server\n  options (\n      object 'users'\n  );\n"))),(0,n.kt)("h4",{id:"organization-table"},"Organization Table"),(0,n.kt)("p",null,"This table will store information about the organizations."),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Note: The current limit is 500 organizations. We are working to increase this limitation in future releases."),(0,n.kt)("pre",{parentName:"blockquote"},(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create foreign table clerk_organizations (\n  organization_id text,\n  name text,\n  slug text,\n  created_at bigint,\n  updated_at bigint,\n  created_by text\n)\nserver my_clerk_server\noptions (\n  object 'organizations'\n);\n"))),(0,n.kt)("h4",{id:"junction-table"},"Junction Table"),(0,n.kt)("p",null,"This table connects the ",(0,n.kt)("inlineCode",{parentName:"p"},"clerk_users")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"clerk_orgs"),". It lists out all users and their roles in each organization."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"create foreign table clerk_organization_memberships (\n  user_id text,\n  organization_id text,\n  role text\n)\nserver my_clerk_server\noptions (\n  object 'organization_memberships'\n);\n")),(0,n.kt)("h2",{id:"dive-into-the-data"},"Dive into the Data"),(0,n.kt)("p",null,"Now you can query through your database and get useful information like:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"How many organizations have been created each week in the past"),(0,n.kt)("li",{parentName:"ul"},"How many users have signed up in the past 30 days"),(0,n.kt)("li",{parentName:"ul"},"What organizations is a user part of"),(0,n.kt)("li",{parentName:"ul"},"All users and their roles in an organization"),(0,n.kt)("li",{parentName:"ul"},"And more\u2026.")),(0,n.kt)("p",null,"Here are some of the charts we were able to make from the clerk foreign data wrapper using some synthetic data."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"chart1",src:a(69021).Z,title:"Daily New Signups",width:"582",height:"356"}),"\n",(0,n.kt)("img",{alt:"chart2",src:a(34638).Z,title:"Total Organizations",width:"581",height:"351"})),(0,n.kt)("h2",{id:"conclusion"},"Conclusion"),(0,n.kt)("p",null,"In conclusion, we believe that Postgres\u2019 concept of Foreign Data Wrappers is more than just a technical integration\u2014it's a game-changer that allows Postgres users to build data warehouse platforms that reach across all data sources in the business. It paves the way for businesses to harness critical insights directly from their operational databases, making informed decisions easier than ever before. See examples of other ",(0,n.kt)("a",{parentName:"p",href:"https://pgt.dev/?cat=connectors"},"FDWs in Trunk")),(0,n.kt)("p",null,"Give us a star and try out ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/tembo-io/clerk_fdw"},"clerk_fdw")," by running the example in the README. If you hit any snags, please create an issue. We would greatly welcome contributions to the project as well."))}d.isMDXComponent=!0},69021:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/chart1-f041e3a0ece55d964478a2e23fffc37d.png"},34638:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/chart2-c1ad7d55ca70c351cda145b80752bf19.png"},54371:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/clerk-flowchart-ecda66b28a07b45684d4932e0aac931a.png"}}]);