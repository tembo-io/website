"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1387],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),p=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(i.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=o,k=u["".concat(i,".").concat(d)]||u[d]||m[d]||a;return n?r.createElement(k,s(s({ref:t},c),{},{components:n})):r.createElement(k,s({ref:t},c))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[u]="string"==typeof e?e:o,s[1]=l;for(var p=2;p<a;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},75182:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var r=n(87462),o=(n(67294),n(3905));const a={sidebar_position:8},s="Running the Tembo Operator on AWS EKS",l={unversionedId:"tembo-stacks/tembo-operator-eks",id:"tembo-stacks/tembo-operator-eks",title:"Running the Tembo Operator on AWS EKS",description:"The Tembo Operator allows you to run multiple Tembo Stacks on Kubernetes. This guide shows you how to set up the Tembo",source:"@site/docs/tembo-stacks/tembo-operator-eks.md",sourceDirName:"tembo-stacks",slug:"/tembo-stacks/tembo-operator-eks",permalink:"/docs/tembo-stacks/tembo-operator-eks",draft:!1,editUrl:"https://github.com/tembo-io/website/blob/main/docs/tembo-stacks/tembo-operator-eks.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Running the Tembo Operator Locally",permalink:"/docs/tembo-stacks/local-tembo-operator"},next:{title:"Postgres Guides",permalink:"/docs/category/postgres-guides"}},i={},p=[{value:"Step 1: Clone the repo",id:"step-1-clone-the-repo",level:2},{value:"Step 2: Navigate to the <code>tembo-operator</code> directory",id:"step-2-navigate-to-the-tembo-operator-directory",level:2},{value:"Step 3: Install dependencies on the Kubernetes cluster",id:"step-3-install-dependencies-on-the-kubernetes-cluster",level:2},{value:"Step 4: Install the Tembo Operator into the Kubernetes cluster",id:"step-4-install-the-tembo-operator-into-the-kubernetes-cluster",level:2},{value:"Step 5: Deploy a Tembo Stack instance",id:"step-5-deploy-a-tembo-stack-instance",level:2},{value:"Step 6: Obtain connection password",id:"step-6-obtain-connection-password",level:2},{value:"Step 7: Setup port-forwarding",id:"step-7-setup-port-forwarding",level:2},{value:"Step 8: Connect",id:"step-8-connect",level:2},{value:"Step 9. Enjoy and ask questions!",id:"step-9-enjoy-and-ask-questions",level:2}],c={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"running-the-tembo-operator-on-aws-eks"},"Running the Tembo Operator on AWS EKS"),(0,o.kt)("p",null,"The Tembo Operator allows you to run multiple Tembo Stacks on Kubernetes. This guide shows you how to set up the Tembo\nOperator on AWS EKS and provides an example of spinning up and connecting to a Postgres instance hosted on Kubernetes."),(0,o.kt)("p",null,"This tutorial requires the following prerequisites:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"AWS EKS Cluster configured with a storage provisioner. See the following guides if you're creating these from scratch:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://eksctl.io/getting-started/"},"Getting started with eksctl")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/eks/latest/userguide/managing-ebs-csi.html"},"Managing the Amazon EBS CSI driver as an Amazon EKS add-on")),(0,o.kt)("li",{parentName:"ul"},"Optional: Configure your Cluster from Scratch")))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"These commands follow the AWS guides linked above"),(0,o.kt)("div",null,(0,o.kt)("p",null,(0,o.kt)("h4",null,"Create a Cluster using eksctl"),(0,o.kt)("code",null,"eksctl create cluster --region us-east-1 --zones=us-east-1a,us-east-1b,us-east-1c,us-east-1d,us-east-1f --version 1.28"),(0,o.kt)("h1",null)),(0,o.kt)("p",null,(0,o.kt)("h4",null,"Find Cluster Name"),(0,o.kt)("code",null,"eksctl get clusters")),(0,o.kt)("p",null,(0,o.kt)("h4",null,"Determine OIDC Issuer ID"),(0,o.kt)("p",null,(0,o.kt)("code",null,"cluster_name=",(0,o.kt)("i",null,"my-cluster-name"))),(0,o.kt)("p",null,(0,o.kt)("code",null,"oidc_id=$(aws eks describe-cluster --name $cluster_name --query \"cluster.identity.oidc.issuer\" --output text | cut -d '/' -f 5)"))),(0,o.kt)("p",null,(0,o.kt)("h4",null,"Create an OIDC Identity Provider for your cluster"),(0,o.kt)("code",null,"eksctl utils associate-iam-oidc-provider --cluster $cluster_name --approve")),(0,o.kt)("p",null,(0,o.kt)("h4",null,"Create Amazon EBS CSI plugin IAM role"),(0,o.kt)("code",null,"eksctl create iamserviceaccount \\ --name ebs-csi-controller-sa \\ --namespace kube-system \\ --cluster ",(0,o.kt)("i",null,"my-cluster-name")," \\ --role-name AmazonEKS_EBS_CSI_DriverRole \\ --role-only \\ --attach-policy-arn arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy \\ --approve")),(0,o.kt)("p",null,(0,o.kt)("h4",null,"Add Amazon EBS CSI add-on"),(0,o.kt)("code",null,"eksctl create addon --name aws-ebs-csi-driver --cluster ",(0,o.kt)("i",null,"my-cluster-name")," --service-account-role-arn arn:aws:iam::",(0,o.kt)("i",null,"my-account-number"),":role/AmazonEKS_EBS_CSI_DriverRole --force")))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/casey/just"},"just")," command runner installed"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://helm.sh/"},"helm")," package manager installed")),(0,o.kt)("h2",{id:"step-1-clone-the-repo"},"Step 1: Clone the repo"),(0,o.kt)("p",null,"Clone the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tembo-io/tembo-stacks/tree/main"},"Tembo Stacks Repo"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/tembo-io/tembo-stacks.git\n")),(0,o.kt)("h2",{id:"step-2-navigate-to-the-tembo-operator-directory"},"Step 2: Navigate to the ",(0,o.kt)("inlineCode",{parentName:"h2"},"tembo-operator")," directory"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd tembo-stacks/tembo-operator\n")),(0,o.kt)("h2",{id:"step-3-install-dependencies-on-the-kubernetes-cluster"},"Step 3: Install dependencies on the Kubernetes cluster"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"just --set STORAGE_CLASS_NAME gp2 install-dependencies\n")),(0,o.kt)("h2",{id:"step-4-install-the-tembo-operator-into-the-kubernetes-cluster"},"Step 4: Install the Tembo Operator into the Kubernetes cluster"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"just install-chart\n")),(0,o.kt)("h2",{id:"step-5-deploy-a-tembo-stack-instance"},"Step 5: Deploy a Tembo Stack instance"),(0,o.kt)("p",null,"Choose a Tembo Stack you would like to use. "),(0,o.kt)("p",null,"Here we are using ",(0,o.kt)("inlineCode",{parentName:"p"},"sample-machine-learning.yaml"),", but there are ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tembo-io/tembo-stacks/tree/main/tembo-operator/yaml"},"other samples"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl apply -f yaml/sample-machine-learning.yaml\n")),(0,o.kt)("h2",{id:"step-6-obtain-connection-password"},"Step 6: Obtain connection password"),(0,o.kt)("p",null,"Get your connection password and save it as an environment variable."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"export PGPASSWORD=$(kubectl get secrets/sample-machine-learning-connection --template={{.data.password}} | base64 -D)\n")),(0,o.kt)("h2",{id:"step-7-setup-port-forwarding"},"Step 7: Setup port-forwarding"),(0,o.kt)("p",null,"Port Forward from your Kubernetes to your local machine."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl port-forward svc/sample-machine-learning-rw 5432:5432 &\n")),(0,o.kt)("h2",{id:"step-8-connect"},"Step 8: Connect"),(0,o.kt)("p",null,"Connect to the running Postgres instance:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"psql postgres://postgres:$PGPASSWORD@localhost:5432\n")),(0,o.kt)("h2",{id:"step-9-enjoy-and-ask-questions"},"Step 9. Enjoy and ask questions!"),(0,o.kt)("p",null,"Any questions? Feel free to ask our team in our ",(0,o.kt)("a",{parentName:"p",href:"https://join.slack.com/t/tembocommunity/shared_invite/zt-23o25qt91-AnZoC1jhLMLubwia4GeNGw"},"Slack Community")," or email ",(0,o.kt)("a",{parentName:"p",href:"mailto:support@tembo.io"},"support@tembo.io"),"."))}m.isMDXComponent=!0}}]);