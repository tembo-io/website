"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1793],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),h=r,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||o;return n?a.createElement(m,i(i({ref:t},c),{},{components:n})):a.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),r=n(86010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,i),hidden:n},t)}},74866:(e,t,n)=>{n.d(t,{Z:()=>k});var a=n(87462),r=n(67294),o=n(86010),i=n(12466),l=n(16550),s=n(91980),u=n(67392),c=n(50012);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function d(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=d(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[s,u]=m({queryString:n,groupId:a}),[p,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,c.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),b=(()=>{const e=s??p;return h({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{b&&l(b)}),[b]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),g(e)}),[u,g,o]),tabValues:o}}var b=n(72389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:n,selectedValue:l,selectValue:s,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,i.o5)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),a=u[n].value;a!==l&&(p(t),s(a))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:h,onClick:d},i,{className:(0,o.Z)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":l===t})}),n??t)})))}function T(e){let{lazy:t,children:n,selectedValue:a}=e;const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function v(e){const t=g(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",f.tabList)},r.createElement(y,(0,a.Z)({},e,t)),r.createElement(T,(0,a.Z)({},e,t)))}function k(e){const t=(0,b.Z)();return r.createElement(v,(0,a.Z)({key:String(t)},e))}},40428:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>u,toc:()=>p});var a=n(87462),r=(n(67294),n(3905)),o=n(74866),i=n(85162);const l={sidebar_position:1,tags:["api","tools","containers"]},s="graphQL",u={unversionedId:"tembo-cloud/application-services/GRAPHQL",id:"tembo-cloud/application-services/GRAPHQL",title:"graphQL",description:"Powered by PostgREST and pg_graphql",source:"@site/docs/tembo-cloud/application-services/GRAPHQL.md",sourceDirName:"tembo-cloud/application-services",slug:"/tembo-cloud/application-services/GRAPHQL",permalink:"/docs/tembo-cloud/application-services/GRAPHQL",draft:!1,editUrl:"https://github.com/tembo-io/website/blob/main/docs/tembo-cloud/application-services/GRAPHQL.md",tags:[{label:"api",permalink:"/docs/tags/api"},{label:"tools",permalink:"/docs/tags/tools"},{label:"containers",permalink:"/docs/tags/containers"}],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,tags:["api","tools","containers"]},sidebar:"tutorialSidebar",previous:{title:"Application Services",permalink:"/docs/category/application-services"},next:{title:"REST API",permalink:"/docs/tembo-cloud/application-services/REST-API"}},c={},p=[{value:"Enabling graphQL on Tembo Cloud",id:"enabling-graphql-on-tembo-cloud",level:2},{value:"Using graphQL",id:"using-graphql",level:2},{value:"Insert a record with the graphQL API using a mutation",id:"insert-a-record-with-the-graphql-api-using-a-mutation",level:3},{value:"Query the database with the graphQL API",id:"query-the-database-with-the-graphql-api",level:3},{value:"Advanced",id:"advanced",level:3}],d={toc:p},h="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"graphql"},"graphQL"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Powered by ",(0,r.kt)("a",{parentName:"strong",href:"https://postgrest.org/en/stable/"},"PostgREST")," and ",(0,r.kt)("a",{parentName:"strong",href:"https://github.com/supabase/pg_graphql"},"pg_graphql")))),(0,r.kt)("p",null,"GraphQL is a query language for APIs, as well as a server-side runtime for executing those queries by using a type system that you define for your data. It offers a more efficient, flexible, and powerful alternative to the traditional REST API. Instead of accessing multiple endpoints to fetch or modify data, GraphQL enables you to request exactly what you need and nothing more from a single endpoint. This minimizes over-fetching or under-fetching of data, which can lead to faster and more efficient applications."),(0,r.kt)("p",null,"The primary advantage of GraphQL is its flexibility. Clients can specify exactly what data they need, allowing developers to reduce the amount of data transferred over the network, thereby improving the performance of their applications. Additionally, GraphQL provides a clear description of the data available, making it easier for both clients and servers to understand and evolve the data over time. This makes the development process more dynamic and adaptable to changing needs."),(0,r.kt)("p",null,"In Tembo Cloud, graphQL is made possible by combining ",(0,r.kt)("a",{parentName:"p",href:"https://postgrest.org/en/stable/"},"PostgREST")," to expose an HTTP interface and the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/supabase/pg_graphql"},"pg_graphql")," to handle in-database inflection and query resolution."),(0,r.kt)("h2",{id:"enabling-graphql-on-tembo-cloud"},"Enabling graphQL on Tembo Cloud"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Coming soon: enable graphQL via the ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.tembo.io"},"Tembo Cloud UI"))),(0,r.kt)("p",null,"First, you will need to generate an API token so that you can communicate with your Tembo instance. Navigate to cloud.tembo.io/generate-jwt and follow the instructions to generate a token. Alternatively, you can follow the instructions ",(0,r.kt)("a",{parentName:"p",href:"https://tembo.io/docs/tembo-cloud/security-and-authentication/api-authentication"},"here"),"."),(0,r.kt)("p",null,"Set your Tembo token as an environment variable, along with your organization id and the Tembo instance id. Fetch the ",(0,r.kt)("inlineCode",{parentName:"p"},"TEMBO_DATA_DOMAIN"),' from the "Host" parameter of your Tembo instance.'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export TEMBO_TOKEN=<your token>\nexport TEMBO_ORG=<your organization id>\nexport TEMBO_INST=<your instance id>\nexport TEMBO_DATA_DOMAIN=<you Tembo domain>\n")),(0,r.kt)("p",null,"Patch your existing Tembo instance using the ",(0,r.kt)("a",{parentName:"p",href:"https://tembo.io/docs/tembo-cloud/openapi"},"Tembo Cloud Platform API")," to enable graphQL. We'll set the the configurations to ",(0,r.kt)("inlineCode",{parentName:"p"},"None")," in this example so that the defaults are assigned."),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'import requests\n\nTEMBO_ORG = os.environ["TEMBO_ORG"]\nTEMBO_INST = os.environ["TEMBO_INST"]\nTEMBO_TOKEN = os.environ["TEMBO_TOKEN"]\n\nresp = requests.patch(\n    url=f"https://api.tembo.io/orgs/{TEMBO_ORG}/instances/{TEMBO_INST}",\n    headers={"Authorization": f"Bearer {TEMBO_TOKEN}"},\n    json={\n        "app_services": [\n            {"http": None},  // default configuration\n        ]\n    }\n)\n'))),(0,r.kt)(i.Z,{value:"curl",label:"Curl",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X PATCH \\\n  -H "Authorization: Bearer ${TEMBO_TOKEN}" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"app_services": [{"http": null}]}\' \\\n  "https://api.tembo.io/orgs/${TEMBO_ORG}/instances/${TEMBO_INST}"\n')))),(0,r.kt)("h2",{id:"using-graphql"},"Using graphQL"),(0,r.kt)("p",null,"graphQL is served from an HTTP interface that lives within your data plane domain. This value is the same value as the host on your Tembo Postgres instance and can be found in at cloud.tembo.io."),(0,r.kt)("p",null,"First, create a table in the database:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"psql postgres://$yourUser:$yourPassword@${TEMBO_DATA_DOMAIN}:5432/postgres\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE products (\n  uid int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,\n  name text NOT NULL,\n  category text NOT NULL,\n  unit_price numeric NOT NULL,\n  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()\n);\n")),(0,r.kt)("p",null,"Then, let's add a record to the table:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO products values (DEFAULT, 'pen', 'office-supplies', 0.75);\n")),(0,r.kt)("h3",{id:"insert-a-record-with-the-graphql-api-using-a-mutation"},"Insert a record with the graphQL API using a mutation"),(0,r.kt)("p",null,"To use a mutation, we must first define a function. Let's add a function which will let us add products."),(0,r.kt)("p",null,"Run the following SQL in the database to create the function:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},'create function "addProduct"(name text, category text, unit_price numeric)\n  returns int\n  volatile\n  language sql\nas $$ insert into products (name, category, unit_price) values (name, category, unit_price) returning uid; $$;\n')),(0,r.kt)("p",null,"Then we can call the function using the graphQL API."),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'TEMBO_DATA_DOMAIN = os.environ["TEMBO_DATA_DOMAIN"]\n\nresp = requests.post(\n    url=f"https://{TEMBO_DATA_DOMAIN}/graphql/v1",\n    headers={"Authorization": f"Bearer {TEMBO_TOKEN}"},\n    json={\n        "query": \'\'\'\n            mutation {\n                addProduct(name: "computer", category: "electronics", unit_price: "999.99") {\n                    product {\n                        name\n                        category\n                        unit_price\n                    }\n                }\n            }\n        \'\'\',\n    }\n)\n\nresp.json()\n'))),(0,r.kt)(i.Z,{value:"curl",label:"Curl",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST \\\n  -H "Authorization: Bearer ${TEMBO_TOKEN}" \\\n  -H "Content-Type: application/json" \\\n     -d \'{\n           "query": "mutation { addProduct(name: \\"computer\\", category: \\"electronics\\", unit_price: \\"999.99\\") { product { name, category, unit_price } } }"\n         }\' \\\n  "https://${TEMBO_DATA_DOMAIN/graphql/v1"\n')))),(0,r.kt)("p",null,"You should see the following response. Note that the function we created simply returns the new product's uid."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "addProduct": 2\n  }\n}\n')),(0,r.kt)("h3",{id:"query-the-database-with-the-graphql-api"},"Query the database with the graphQL API"),(0,r.kt)("p",null,"Now we can query the products table using graphQL syntax.\nIf you've been following the example, there should be two products in the database; a pen and a computer.\nLet's query the database and ask for products that have a unit price less than 2."),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"py",label:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'TEMBO_DATA_DOMAIN = os.environ["TEMBO_DATA_DOMAIN"]\n\nresp = requests.post(\n    url=f"https://{TEMBO_DATA_DOMAIN}/graphql/v1",\n    headers={"Authorization": f"Bearer {TEMBO_TOKEN}"},\n    json={\n        "query": \'\'\'\n        {\n            productsCollection(filter: { unit_price: {lt: "2" }})\n            {\n                edges { node { uid, name, category, unit_price } }\n            }\n        }\n        \'\'\',\n    }\n)\n\nresp.json()\n'))),(0,r.kt)(i.Z,{value:"curl",label:"Curl",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST \\\n  -H "Authorization: Bearer ${TEMBO_TOKEN}" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n           "query": "{ products1Collection(filter: { unit_price: {lt: \\"2\\" }}) { edges { node { uid, name, category, unit_price } } } }"\n    }\' \\\n  "https://${TEMBO_DATA_DOMAIN/graphql/v1"\n')))),(0,r.kt)("p",null,"And you should see the following response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "products1Collection": {\n      "edges": [\n        {\n          "node": {\n            "uid": 1,\n            "name": "pen",\n            "category": "office-supplies",\n            "unit_price": "0.75"\n          }\n        }\n      ]\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"advanced"},"Advanced"),(0,r.kt)("p",null,"For advanced configuration, refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://postgrest.org/en/stable/"},"PostgREST")," and ",(0,r.kt)("a",{parentName:"p",href:"https://supabase.github.io/pg_graphql/api/"},"pg_graphql")," project documentation for more information, and give them a star!"))}m.isMDXComponent=!0}}]);