<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Postgres 16: The exciting and the unnoticed | Tembo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tembo.io/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://tembo.io/img/social-card.png"><meta data-rh="true" property="og:url" content="https://tembo.io/blog/postgres-16"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Postgres 16: The exciting and the unnoticed | Tembo"><meta data-rh="true" name="description" content="In case you missed it, Postgres 16 came out last week - and this year it arrived earlier than the last few years. There are many features that I’ve been looking forward to for the last few months and I’m excited to see them get into the hands of users. Before we dive into the specific features of this release, let’s discuss what a Postgres major release actually means."><meta data-rh="true" property="og:description" content="In case you missed it, Postgres 16 came out last week - and this year it arrived earlier than the last few years. There are many features that I’ve been looking forward to for the last few months and I’m excited to see them get into the hands of users. Before we dive into the specific features of this release, let’s discuss what a Postgres major release actually means."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-09-20T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/samay-sharma"><meta data-rh="true" property="article:tag" content="postgres"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tembo.io/blog/postgres-16"><link data-rh="true" rel="alternate" href="https://tembo.io/blog/postgres-16" hreflang="en"><link data-rh="true" rel="alternate" href="https://tembo.io/blog/postgres-16" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tembo RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tembo Atom Feed">





<script id="hs-script-loader" src="//js.hs-scripts.com/23590420.js"></script>
<link rel="preconnect" href="https://cdn.segment.io">
<script>!function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],e.factory=function(t){return function(){if(window.analytics.initialized)return window.analytics[t].apply(window.analytics,arguments);var n=Array.prototype.slice.call(arguments);return n.unshift(t),e.push(n),e}};for(var t=0;t<e.methods.length;t++){var n=e.methods[t];e[n]=e.factory(n)}e.load=function(t,n){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(a,i),e._loadOptions=n},e._writeKey="YT4AfD2TuYaN7DiGR20tAnstYP1ujjyE",e.SNIPPET_VERSION="4.16.1",e.load("YT4AfD2TuYaN7DiGR20tAnstYP1ujjyE"),e.page()}}()</script>
<link key="docusaurus-plugin-plausible-preconnect" rel="preconnect" href="https://plausible.io">
<script key="docusaurus-plugin-plausible-script" async defer="defer" data-domain="tembo.io" src="https://plausible.io/js/plausible.js"></script>
<script key="docusaurus-plugin-plausible-custom-events">window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script>

<script>prefinery=window.prefinery||function(){(window.prefinery.q=window.prefinery.q||[]).push(arguments)}</script>
<script src="https://widget.prefinery.com/widget/v2/yisnnyak.js" defer="defer"></script><link rel="stylesheet" href="/assets/css/styles.92bb70b2.css">
<link rel="preload" href="/assets/js/runtime~main.ef584dc9.js" as="script">
<link rel="preload" href="/assets/js/main.75ceccb8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/title-logo.svg" alt="Tembo Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/title-logo.svg" alt="Tembo Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" href="/docs">Docs</a><a class="navbar__item navbar__link" target="_blank" href="/blog">Blog</a><a href="https://cloud.tembo.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Tembo Cloud<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/tembo-io/tembo-stacks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep8">Hacking Postgres, Ep. 8: Philippe Noël</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/pgmq-self-regulating-queue">PGMQ: Lightweight Message Queue on Postgres with No Background Worker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep7">Hacking Postgres Ep. 7: Burak Yucesoy</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tembo-operator-apps">Application Services: Helping Postgres Do More, Faster</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep6">Hacking Postgres, Ep. 6: Regina Obe and Paul Ramsey</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tembo-operator">Tembo Operator: A Rust-based Kubernetes Operator for Postgres</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/anon-dump">Anonymized dump of your Postgres data</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep5">Hacking Postgres, Ep. 5: Alexander Korotkov</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep4">Hacking Postgres, Ep. 4: Pavlo Golub</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep3">Hacking Postgres, Ep. 3: Eric Ridge</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep2">Hacking Postgres, Ep. 2: Adam Hendel</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/pgvector-and-embedding-solutions-with-postgres">Unleashing the power of vector embeddings with PostgreSQL</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/hacking-postgres-ep1">Hacking Postgres Ep. 1: Marco Slot</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/introducing-terraform-provider-for-tembo">Introducing Terraform Provider for Tembo</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/clerk-fdw">Unlocking value from your Clerk User Management platform with Postgres</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/table-version-history">Version History and Lifecycle Policies for Postgres Tables</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/postgres-extension-in-rust-pgmq">Anatomy of a Postgres extension written in Rust: pgmq</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/postgres-16">Postgres 16: The exciting and the unnoticed</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/four-types-of-extensions">Enter the matrix: the four types of Postgres extensions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tembo-stacks-intro">Tembo Stacks: Making Postgres the Everything Database</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/optimizing-postgres-auto-vacuum">Optimizing Postgres&#x27;s Autovacuum for High-Churn Tables</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/pgmq-with-python">Using pgmq with Python</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/introducing-pg-later">Introducing pg_later: Asynchronous Queries for Postgres, Inspired by Snowflake</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/introducing-pgmq">Introducing PGMQ: Simple Message Queues built on Postgres</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tembo-manifesto">Tembo Manifesto</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/introducing-tembo">Introducing Tembo</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Postgres 16: The exciting and the unnoticed</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-09-20T00:00:00.000Z" itemprop="datePublished">September 20, 2023</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/samay-sharma" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/samay-sharma.png" alt="Samay Sharma"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/samay-sharma" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Samay Sharma</span></a></div><small class="avatar__subtitle" itemprop="description">CTO Tembo</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>In case you missed it, Postgres 16 came out last week - and this year it arrived earlier than the last few years. There are many features that I’ve been looking forward to for the last few months and I’m excited to see them get into the hands of users. Before we dive into the specific features of this release, let’s discuss what a Postgres major release actually means.</p><p><img loading="lazy" alt="postgres-16" src="/assets/images/postgres-16-1cfe231777e20520fac3b292397f20e6.png" title="PG16" width="1666" height="1140" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="postgres-releases">Postgres Releases<a href="#postgres-releases" class="hash-link" aria-label="Direct link to Postgres Releases" title="Direct link to Postgres Releases">​</a></h2><p>The PostgreSQL Global Development Group releases a new <em>major</em> <a href="https://www.postgresql.org/support/versioning/" target="_blank" rel="noopener noreferrer">version</a> every year with new features. </p><p>In addition, Postgres releases minor versions of each major release every 3 months or so with bug fixes and security fixes. No new features are released in minor versions, and that’s what makes major version releases so exciting as it’s the culmination of about a year’s worth of development work on the project. </p><p>While there&#x27;s a case to be made for faster release of features, Postgres prides itself on stability and this release cadence provides enough time for features to be proposed, reviewed, committed and tested before they get shipped.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="should-i-upgrade-to-postgres-16">Should I upgrade to Postgres 16?<a href="#should-i-upgrade-to-postgres-16" class="hash-link" aria-label="Direct link to Should I upgrade to Postgres 16?" title="Direct link to Should I upgrade to Postgres 16?">​</a></h2><p>If you are building a new application, yes, I would recommend that you start with the latest major version of Postgres. This will guarantee the latest and greatest features, and a continuous flow of minor releases that fix bugs and improve the security of your database.</p><p>If you are upgrading an existing system, there are more factors to consider. The general advice is to <strong>upgrade minor versions</strong> always - because they contain security and bug fixes and the risk of not upgrading is higher. </p><p>However, for major versions, you will need to consider the tradeoffs as the major versions usually change the internal format of system tables and data files. That means, you can’t just use previous versions of the data directory — you’ll need to use <code>pg_dump</code> / <code>pg_restore</code> or <a href="https://www.postgresql.org/docs/current/pgupgrade.html" target="_blank" rel="noopener noreferrer">pg_upgrade</a> to upgrade. In addition, depending on the features you are using and the Postgres release, manual changes to your code or queries may also be required.</p><p>Obviously, another important factor if you are using a managed service provider is when they provide support for Postgres 16. At <a href="https://cloud.tembo.io/" target="_blank" rel="noopener noreferrer">Tembo Cloud</a>, we’ve already started working on supporting Postgres 16 and expect it to be available in a few weeks.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-most-exciting-about-postgres-16">What’s most exciting about Postgres 16?<a href="#whats-most-exciting-about-postgres-16" class="hash-link" aria-label="Direct link to What’s most exciting about Postgres 16?" title="Direct link to What’s most exciting about Postgres 16?">​</a></h2><p>Postgres 16 delivers exciting features in all aspects of the database ranging from performance improvements, monitoring enhancements, better security and privilege handling, replication improvements, new server features and commands and a lot more. </p><p>If you’re interested in the complete list of features, you can read the detailed <a href="https://www.postgresql.org/docs/16/release-16.html" target="_blank" rel="noopener noreferrer">release notes</a>. Below, I’ll talk about the aspects of this release which excite me the most and we will talk about a few not-so-talked about features which lay the groundwork for more exciting features in Postgres 17.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="logical-replication-improvements">Logical replication improvements<a href="#logical-replication-improvements" class="hash-link" aria-label="Direct link to Logical replication improvements" title="Direct link to Logical replication improvements">​</a></h3><p><a href="https://www.postgresql.org/docs/current/logical-replication.html" target="_blank" rel="noopener noreferrer">Logical replication</a> is a feature I’ve always been interested in, as it allows you to expand the capabilities of Postgres by moving data between different Postgres databases or from Postgres to other databases. It finds interesting use cases in: replicating selectively from one database to another, replicating across Postgres versions, online migrations and allowing consolidation from multiple databases.</p><p>This release, arguably the most exciting logical replication feature, is allowing <a href="https://pganalyze.com/blog/5mins-postgres-16-logical-decoding" target="_blank" rel="noopener noreferrer">logical replication from standby servers</a>. Prior to this feature, you could only create a logical replication slot on the primary which meant adding more replicas would add more load on the primary. With Postgres 16, secondaries also have the ability to create replication slots allowing for more distribution of that load. What’s more is that the replication slots on the secondary are persisted even when the standby is promoted to the primary. This means that subscribers won’t be affected even during a failover! You can read more about this feature in Bertrand’s <a href="https://bdrouvot.github.io/2023/04/19/postgres-16-highlight-logical-decoding-on-standby/" target="_blank" rel="noopener noreferrer">blog post</a>.</p><p>The short of it is that now you can do this on a Postgres 16 standby:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">postgres@standby=# select pg_is_in_recovery();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> pg_is_in_recovery</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(1 row)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postgres@standby=# SELECT * FROM pg_create_logical_replication_slot(&#x27;active_slot&#x27;, &#x27;test_decoding&#x27;, false, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  slot_name  |    lsn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------+------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> active_slot | 0/C0053A78</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(1 row)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On Postgres 15, the same thing would have errored out:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">postgres@standby=# SELECT * FROM pg_create_logical_replication_slot(&#x27;active_slot&#x27;, &#x27;test_decoding&#x27;, false, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ERROR:  logical decoding cannot be used while in recovery</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In addition to this, there are a number of other logical replication performance improvements. This includes faster initial table sync using <a href="https://www.postgresql.org/message-id/flat/TYCPR01MB8373B593010467315C2BA8EBED229%40TYCPR01MB8373.jpnprd01.prod.outlook.com#be8109723de40d3724730713175517ab" target="_blank" rel="noopener noreferrer">binary format</a>, use of <a href="https://www.postgresql.org/message-id/flat/CACawEhX6TvX%2Bj8EpcpCKvnMGao8Gcp8W43Sgc87pg9o6-Xbf2Q%40mail.gmail.com#81e7ec5c7732e7492c9e28d0f38df657" target="_blank" rel="noopener noreferrer">btree indexes</a> during logical replication apply when tables don’t have a primary key (previously the table would be scanned sequentially) and parallel application of large transactions (~25-40% speedups).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring-improvements">Monitoring improvements<a href="#monitoring-improvements" class="hash-link" aria-label="Direct link to Monitoring improvements" title="Direct link to Monitoring improvements">​</a></h3><p>The other bucket of features which intrigued me are the monitoring enhancements. While Postgres provides a number of statistics tables with monitoring information, I believe more can be done to provide actionable insights to users. As an example, Lukas pointed out several interesting gaps in Postgres monitoring in his <a href="https://www.pgcon.org/events/pgcon_2020/sessions/session/132/slides/49/Whats%20Missing%20for%20Postgres%20Monitoring.pdf" target="_blank" rel="noopener noreferrer">PGCon 2020 talk</a>.</p><p>Coming back to this release, <a href="https://www.postgresql.org/docs/16/monitoring-stats.html#MONITORING-PG-STAT-IO-VIEW" target="_blank" rel="noopener noreferrer"><code>pg_stat_io</code></a> has to be the most useful piece of information added to the Postgres stats views in Postgres 16. It allows you to understand the I/O done by Postgres at a more granular level, broken down by <code>backend_type</code> and <code>context</code>. This means you can calculate a more accurate cache hit ratio by ignoring the I/O done by VACUUM, differentiate between <code>extends</code> and <code>flushes</code>, and separate out bulk operations while deciding which configurations to tune. Melanie talks about this and much more in her <a href="https://www.youtube.com/watch?v=rCzSNdUOEdg" target="_blank" rel="noopener noreferrer">talk</a> and this <a href="https://www.depesz.com/2023/02/27/waiting-for-postgresql-16-add-pg_stat_io-view-providing-more-detailed-io-statistics/" target="_blank" rel="noopener noreferrer">blog post</a> approaches how you would use this as a DBA.</p><p>Here is an example of the statistics you can see in <code>pg_stat_io</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ SELECT * FROM pg_stat_io ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backend_type     │   io_object   │ io_context │  reads  │ writes  │ extends │ op_bytes │ evictions │ reuses  │ fsyncs │          stats_reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">─────────────────────┼───────────────┼────────────┼─────────┼─────────┼─────────┼──────────┼───────────┼─────────┼────────┼───────────────────────────────</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> autovacuum launcher │ relation      │ bulkread   │       0 │       0 │  [NULL] │     8192 │         0 │       0 │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> autovacuum worker   │ relation      │ bulkread   │       0 │       0 │  [NULL] │     8192 │         0 │       0 │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> client backend      │ temp relation │ normal     │       0 │       0 │       0 │     8192 │         0 │  [NULL] │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> background worker   │ relation      │ bulkread   │  268221 │  268189 │  [NULL] │     8192 │         0 │  268189 │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> checkpointer        │ relation      │ normal     │  [NULL] │   32121 │  [NULL] │     8192 │    [NULL] │  [NULL] │   3356 │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> standalone backend  │ relation      │ bulkread   │       0 │       0 │  [NULL] │     8192 │         0 │       0 │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> startup             │ relation      │ vacuum     │       0 │       0 │       0 │     8192 │         0 │       0 │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> walsender           │ relation      │ bulkread   │       0 │       0 │  [NULL] │     8192 │         0 │       0 │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> walsender           │ temp relation │ normal     │       0 │       0 │       0 │     8192 │         0 │  [NULL] │ [NULL] │ 2023-02-27 13:25:39.725072+01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In addition to this, there are other improvements including the addition of <code>last_seq_scan</code> and <code>last_idx_scan</code> on <code>pg_stat_*</code> tables which allow you to understand index usage better and figure out when plans for a query might have changed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="special-mentions">Special mentions<a href="#special-mentions" class="hash-link" aria-label="Direct link to Special mentions" title="Direct link to Special mentions">​</a></h3><p>Like I said, each release comes with many improvements - and I could not outline them all in a blog post (and if I did, nobody would read it!). But I do want to mention a few other items in Postgres 16 that I won’t be able to dive deeper into but are interesting as well.</p><ul><li>Load balancing with multiple hosts in <code>libpq</code>: This feature allows to balance the load across Postgres read replicas directly within <code>libpq</code> (which is the foundational Postgres client library) without having to use another load balancer. You can read <a href="https://mydbops.wordpress.com/2023/05/07/postgresql-16-brings-load-balancing-support-in-libpq-psql/" target="_blank" rel="noopener noreferrer">this blog post</a> on how this new feature is implemented and can be used.</li><li>Performance: I won’t repeat what’s in the release notes but there’s a long list of performance improvements in this release. There’s support for more parallelism on <code>FULL</code> and <code>OUTER</code> <code>JOINs</code> and on more aggregates, greater usage of incremental sorts, window function optimizations and even an upto 300% performance improvement in <code>COPY</code>.</li><li><code>VACUUM</code> improvements: Last thing I’d mention is improvements to <code>VACUUM</code> which include freezing performance improvements, ability to increase (or decrease) shared buffer usage by <code>VACUUM</code>, and faster loading of <code>VACUUM</code> configs.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="laying-the-groundwork-for-an-exciting-postgres-17-and-beyond">Laying the groundwork for an exciting Postgres 17 (and beyond)<a href="#laying-the-groundwork-for-an-exciting-postgres-17-and-beyond" class="hash-link" aria-label="Direct link to Laying the groundwork for an exciting Postgres 17 (and beyond)" title="Direct link to Laying the groundwork for an exciting Postgres 17 (and beyond)">​</a></h2><p>All of the features mentioned above can immediately add a lot of value to your Postgres usage, but there are new features which lay the groundwork for powerful features in future releases. I’ll quickly touch upon three items that I believe are noteworthy:</p><ul><li>Direct IO and Async IO in Postgres: In Postgres 16, several building blocks for implementing direct and <a href="https://www.youtube.com/watch?v=CD0w3gWBF7s" target="_blank" rel="noopener noreferrer">asynchronous IO</a> for Postgres were committed. This includes reduced contention on the relation extension lock and addition of Direct IO as a developer only option via the <code>debug_io_direct</code> setting. This important but hard work has been ongoing for several releases and Postgres 17 will likely be the first release where users will be able to utilize these features.</li><li>Moving towards Active Active replication: A feature was committed in Postgres 16 to allow logical replication to avoid replication loops, which is when a transaction gets replicated from source to target and back. Postgres 16 allows subscribers to process only changes which have no origin which allows you to prevent these loops. Bi-directional active-active replication is still very complicated and requires solving a lot of problems, but this feature tackles one of those important sub-problems.</li><li>Migration of the build system to Meson: This might have slipped under your radar but in this release, Postgres added support for a new build system which is expected to replace the Autoconf and Windows based build systems. Why, you might ask? Andres makes a compelling case for it in <a href="https://www.postgresql.org/message-id/flat/20211012083721.hvixq4pnh2pixr3j%40alap3.anarazel.de" target="_blank" rel="noopener noreferrer">this thread</a> if you’re interested but some reasons include faster build times, simpler dependency management and moving towards a common build system across Linux and Windows.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="postgres-continues-to-deliver">Postgres continues to deliver<a href="#postgres-continues-to-deliver" class="hash-link" aria-label="Direct link to Postgres continues to deliver" title="Direct link to Postgres continues to deliver">​</a></h2><p>With every new release, Postgres becomes more and more compelling and adds great features that improve the experience of its users. I recommend you check out the <a href="https://www.postgresql.org/about/news/postgresql-16-released-2715/" target="_blank" rel="noopener noreferrer">press release</a>, and <a href="https://www.postgresql.org/docs/16/release-16.html" target="_blank" rel="noopener noreferrer">the release notes</a> to see everything coming along with this new release.</p><p>And if you want to try out the full power of Postgres including its powerful extension ecosystem on a managed service, try out <a href="https://cloud.tembo.io/" target="_blank" rel="noopener noreferrer">Tembo Cloud</a>.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/postgres">postgres</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/tembo-io/website/blob/main/blog/2023-09-20-postgres-16/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/postgres-extension-in-rust-pgmq"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Anatomy of a Postgres extension written in Rust: pgmq</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/four-types-of-extensions"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Enter the matrix: the four types of Postgres extensions</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#postgres-releases" class="table-of-contents__link toc-highlight">Postgres Releases</a></li><li><a href="#should-i-upgrade-to-postgres-16" class="table-of-contents__link toc-highlight">Should I upgrade to Postgres 16?</a></li><li><a href="#whats-most-exciting-about-postgres-16" class="table-of-contents__link toc-highlight">What’s most exciting about Postgres 16?</a><ul><li><a href="#logical-replication-improvements" class="table-of-contents__link toc-highlight">Logical replication improvements</a></li><li><a href="#monitoring-improvements" class="table-of-contents__link toc-highlight">Monitoring improvements</a></li><li><a href="#special-mentions" class="table-of-contents__link toc-highlight">Special mentions</a></li></ul></li><li><a href="#laying-the-groundwork-for-an-exciting-postgres-17-and-beyond" class="table-of-contents__link toc-highlight">Laying the groundwork for an exciting Postgres 17 (and beyond)</a></li><li><a href="#postgres-continues-to-deliver" class="table-of-contents__link toc-highlight">Postgres continues to deliver</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://tembo.breezy.hr/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Careers<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://pgt.dev/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trunk<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/docs">Docs</a><span class="footer__link-separator">·</span><a href="https://twitter.com/tembo_io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://www.linkedin.com/company/tembo-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Tembo. All Rights Reserved</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ef584dc9.js"></script>
<script src="/assets/js/main.75ceccb8.js"></script>
</body>
</html>